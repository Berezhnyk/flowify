# Plan 01-01: Context Foundation Types and Store

## Goal

Define TypeScript types and create Pinia store for managing file context state. This establishes the data model for codebase context that will be used by all subsequent phases.

## Why This Approach

Following existing codebase patterns:
- Types in `src/types/` with barrel export via `index.ts`
- Pinia stores use Composition API style with refs, computed, and functions
- Enums use UPPER_SNAKE_CASE values
- Interfaces use PascalCase without I prefix

The context store needs to:
- Track files added via drag & drop (phases 2-4)
- Track files fetched from GitHub (phases 6-7)
- Provide context to AI requests (phase 8)
- Support file removal and clearing

## Tasks

### Task 1: Create context types

Create `src/types/context.ts` with types for file context management.

**Types to define:**

```typescript
// Source of the context file
export enum ContextSource {
  LOCAL = 'local',      // Drag & drop from filesystem
  GITHUB = 'github',    // Fetched from GitHub
}

// Single file in context
export interface ContextFile {
  id: string                    // Unique identifier (crypto.randomUUID)
  name: string                  // File name (e.g., "App.vue")
  path: string                  // Full path or relative path
  content: string               // File content as string
  language: string              // Detected language (e.g., "typescript", "vue")
  size: number                  // Content length in bytes
  source: ContextSource         // Where file came from
  addedAt: Date                 // When file was added
}

// GitHub repository reference
export interface GitHubRepo {
  owner: string                 // Repository owner
  repo: string                  // Repository name
  branch: string                // Branch name (default: main)
  path?: string                 // Optional subdirectory path
}

// Context loading state
export enum ContextLoadingState {
  IDLE = 'idle',
  LOADING = 'loading',
  ERROR = 'error',
}

// Overall context state
export interface CodebaseContext {
  files: ContextFile[]          // All loaded files
  totalSize: number             // Sum of all file sizes
  loadingState: ContextLoadingState
  error: string | null          // Error message if any
  githubRepo: GitHubRepo | null // Current GitHub repo if any
}
```

**Verification:**
- [x] File created at `src/types/context.ts`
- [x] All types exported
- [x] Export added to `src/types/index.ts`
- [x] No TypeScript errors: `npm run type-check`

### Task 2: Create context store

Create `src/stores/context.ts` with Pinia store for managing context state.

**Store structure:**

```typescript
export const useContextStore = defineStore('context', () => {
  // State
  const files = ref<ContextFile[]>([])
  const loadingState = ref<ContextLoadingState>(ContextLoadingState.IDLE)
  const error = ref<string | null>(null)
  const githubRepo = ref<GitHubRepo | null>(null)

  // Getters
  const totalSize = computed(() => files.value.reduce((sum, f) => sum + f.size, 0))
  const fileCount = computed(() => files.value.length)
  const hasContext = computed(() => files.value.length > 0)
  const contextSummary = computed(() => /* file list for AI prompt */)

  // Actions
  function addFile(file: Omit<ContextFile, 'id' | 'addedAt'>): void
  function addFiles(files: Omit<ContextFile, 'id' | 'addedAt'>[]): void
  function removeFile(fileId: string): void
  function clearFiles(): void
  function setLoading(state: ContextLoadingState): void
  function setError(message: string | null): void
  function setGitHubRepo(repo: GitHubRepo | null): void

  return { /* all state, getters, actions */ }
})
```

**Key behaviors:**
- `addFile` generates id and addedAt automatically
- `contextSummary` returns formatted string for AI context injection
- Store is reactive and immediately usable by components

**Verification:**
- [x] File created at `src/stores/context.ts`
- [x] Uses Composition API pattern (not Options API)
- [x] All actions and getters working
- [x] No TypeScript errors: `npm run type-check`

## Verification

After completing both tasks:

1. **Type check passes:**
   ```bash
   npm run type-check
   ```

2. **Types importable:**
   ```typescript
   import type { ContextFile, ContextSource, GitHubRepo } from '@/types'
   ```

3. **Store usable:**
   ```typescript
   import { useContextStore } from '@/stores/context'
   const contextStore = useContextStore()
   contextStore.addFile({ name: 'test.ts', path: '/test.ts', content: '// test', language: 'typescript', size: 7, source: ContextSource.LOCAL })
   console.log(contextStore.fileCount) // 1
   ```

## Estimated Scope

- **Task 1:** ~30 lines of TypeScript types
- **Task 2:** ~80 lines of store code
- **Total:** ~110 lines, straightforward implementation following existing patterns
