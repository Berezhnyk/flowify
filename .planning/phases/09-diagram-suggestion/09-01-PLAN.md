# Plan 09-01: Diagram Suggestion

## Goal

AI analyzes code context and suggests appropriate Mermaid diagram type. When codebase files are loaded, the AI can recommend which diagram type would best represent the code structure.

## Why This Approach

The AI already receives code context. We just need to:
1. Add a prompt enhancement that encourages diagram type suggestion
2. Add a suggestion chip/button in ChatInput for "Suggest diagram for this code"
3. The AI response will include diagram type recommendation

This is mostly prompt engineering - no major code changes needed.

## Tasks

### Task 1: Enhance system prompt for diagram suggestions

Update AIServiceBase.buildSystemPrompt to encourage diagram suggestions when codebase context is present:

```typescript
if (context?.codebaseContext) {
  prompt += `\n\n### Codebase Context\n\nThe user has provided the following code files. Analyze them to help generate appropriate Mermaid diagrams.

When the user asks you to analyze the code or suggest a diagram:
1. Identify the code structure (classes, functions, data flow, state machines, etc.)
2. Recommend the most appropriate diagram type
3. Generate the complete Mermaid diagram

${context.codebaseContext}`
}
```

**Verification:**
- [x] Prompt updated with suggestion guidance
- [x] No TypeScript errors

### Task 2: Add suggestion chip in ChatInput

Add a "Suggest diagram" chip that appears when context is loaded:

```vue
<button
  v-if="hasContext"
  class="suggestion-chip context-chip"
  @click="inputValue = 'Analyze this code and suggest the best diagram type'"
>
  Analyze code
</button>
```

**Verification:**
- [x] Chip shows when context is loaded
- [x] Clicking fills input with analysis prompt
- [x] Styled consistently with other chips

### Task 3: Pass context status to ChatInput

ChatInput needs to know if context is loaded:

```vue
<!-- ChatPanel.vue -->
<ChatInput
  :is-generating="chatStore.isTyping"
  :has-context="contextStore.hasContext"
  @send="handleSendMessage"
  ...
/>

<!-- ChatInput.vue -->
interface Props {
  isGenerating?: boolean
  hasContext?: boolean
}
```

**Verification:**
- [x] hasContext prop passed to ChatInput
- [x] ChatInput receives and uses prop
- [x] No TypeScript errors

## Verification

After completing all tasks:

1. **Type check passes:**
   ```bash
   npm run type-check
   ```

2. **Manual testing:**
   - Drop some code files
   - Click "Analyze code" chip
   - Verify AI suggests appropriate diagram type

## Estimated Scope

- **Task 1:** ~5 lines (prompt update)
- **Task 2:** ~10 lines (chip in template)
- **Task 3:** ~5 lines (prop passing)
- **Total:** ~20 lines
