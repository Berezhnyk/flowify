# Plan 02-01: File Drop Zone

## Goal

Add a drag & drop area to the chat panel that accepts files. This provides the primary interaction for users to add local files as context for AI-assisted diagram generation.

## Why This Approach

The drop zone will be integrated into ChatInput component to provide a natural UX:
- Drop files directly onto the chat input area
- Visual feedback when dragging (border highlight, icon)
- Non-intrusive when not dragging

Following existing patterns:
- Vue 3 Composition API with `<script setup>`
- CSS variables for theming
- Scoped styles with BEM-like naming

## Tasks

### Task 1: Add drag & drop handling to ChatInput

Extend ChatInput.vue with drag & drop event handlers that:
1. Detect dragenter/dragover/dragleave/drop events
2. Emit files to parent via new `files-dropped` event
3. Show visual feedback during drag

**Changes to ChatInput.vue:**

```typescript
// New refs
const isDragging = ref(false)

// New event handler
function handleDragEnter(event: DragEvent) {
  event.preventDefault()
  event.stopPropagation()
  isDragging.value = true
}

function handleDragOver(event: DragEvent) {
  event.preventDefault()
  event.stopPropagation()
}

function handleDragLeave(event: DragEvent) {
  event.preventDefault()
  event.stopPropagation()
  // Only set false if leaving the drop zone entirely
  const rect = (event.currentTarget as HTMLElement).getBoundingClientRect()
  const { clientX, clientY } = event
  if (clientX < rect.left || clientX > rect.right || clientY < rect.top || clientY > rect.bottom) {
    isDragging.value = false
  }
}

function handleDrop(event: DragEvent) {
  event.preventDefault()
  event.stopPropagation()
  isDragging.value = false

  const files = event.dataTransfer?.files
  if (files && files.length > 0) {
    emit('files-dropped', Array.from(files))
  }
}

// Add to emits
interface Emits {
  (e: 'send', message: string): void
  (e: 'stop'): void
  (e: 'files-dropped', files: File[]): void
}
```

**Template changes:**
- Add drag events to root `.chat-input` div
- Add conditional class for drag state
- Add drop overlay with icon

**Style changes:**
- Add `.chat-input--dragging` styles (dashed border, background color)
- Add `.drop-overlay` for centered drop icon/text

**Verification:**
- [x] Drag events attached to ChatInput root element
- [x] `files-dropped` event emitted with File[] on drop
- [x] Visual feedback shows during drag
- [x] No TypeScript errors

### Task 2: Handle dropped files in ChatPanel

Update ChatPanel.vue to:
1. Listen for `files-dropped` event from ChatInput
2. Use context store to add files
3. Read file contents (preparation for Phase 3)

**Changes to ChatPanel.vue:**

```typescript
import { useContextStore } from '@/stores/context'
import { ContextSource } from '@/types'

const contextStore = useContextStore()

async function handleFilesDropped(files: File[]) {
  // For now, just log - actual reading in Phase 3
  console.log('Files dropped:', files.map(f => f.name))

  // Add files to store (content will be empty until Phase 3)
  for (const file of files) {
    contextStore.addFile({
      name: file.name,
      path: file.name, // Just filename for now
      content: '', // Will be read in Phase 3
      language: detectLanguage(file.name),
      size: file.size,
      source: ContextSource.LOCAL,
    })
  }
}

// Simple language detection by extension
function detectLanguage(filename: string): string {
  const ext = filename.split('.').pop()?.toLowerCase() || ''
  const langMap: Record<string, string> = {
    ts: 'typescript',
    tsx: 'typescript',
    js: 'javascript',
    jsx: 'javascript',
    vue: 'vue',
    py: 'python',
    java: 'java',
    go: 'go',
    rs: 'rust',
    rb: 'ruby',
    php: 'php',
    css: 'css',
    scss: 'scss',
    html: 'html',
    json: 'json',
    md: 'markdown',
    yaml: 'yaml',
    yml: 'yaml',
  }
  return langMap[ext] || 'plaintext'
}
```

**Template changes:**
```html
<ChatInput
  :is-generating="chatStore.isTyping"
  @send="handleSendMessage"
  @stop="handleStopGeneration"
  @files-dropped="handleFilesDropped"
/>
```

**Verification:**
- [x] ChatInput emits files-dropped event
- [x] ChatPanel handles the event
- [x] Files added to context store
- [x] Language detection works for common extensions

## Verification

After completing both tasks:

1. **Type check passes:**
   ```bash
   npm run type-check
   ```

2. **Manual testing:**
   - Start dev server: `npm run dev`
   - Drag a .ts file onto chat input
   - Check console for "Files dropped" log
   - Verify context store has the file (use Vue DevTools)

3. **Visual feedback:**
   - Border/background changes during drag
   - Returns to normal after drop or drag leave

## Estimated Scope

- **Task 1:** ~60 lines (events, template, styles)
- **Task 2:** ~40 lines (handler, language detection)
- **Total:** ~100 lines
